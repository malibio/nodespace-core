@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* NodeSpace Warm Gray Design System - from patterns.html */

    /* Color system - Scheme 3: Subtle Tint System (light mode) */
    --primary: 200 40% 45%; /* Blue-gray primary for Scheme 3 */
    --primary-foreground: 0 0% 98%; /* Off-white for primary text */

    --secondary: 200 12% 92%; /* Light blue-gray secondary for Scheme 3 */
    --secondary-foreground: 200 12% 45%; /* Medium blue-gray for secondary text */

    --accent: 200 40% 45%; /* Blue-gray accent for Scheme 3 consistency */
    --accent-foreground: 0 0% 98%; /* Off-white for accent text */

    --background: 0 0% 98%; /* Clean off-white background */
    --foreground: 0 0% 15%; /* Dark neutral gray text - Scheme 3 active items */

    --card: 0 0% 100%; /* Pure white cards */
    --card-foreground: 0 0% 15%; /* Dark neutral gray text */

    --popover: 0 0% 100%; /* Same as cards */
    --popover-foreground: 0 0% 15%;

    --muted: 200 12% 94%; /* Light blue-gray muted areas - Scheme 3 */
    --muted-foreground: 0 0% 25%; /* Medium neutral gray for muted text - Scheme 3 inactive items */

    /* Systematic hover states - WCAG-compliant contrast */
    --hover-background: var(--muted);
    --hover-foreground: var(--muted-foreground);

    --border: 200 12% 88%; /* Light blue-gray borders - Scheme 3 */
    --input: 200 12% 88%;
    --ring: 200 40% 55%; /* Focus ring matches blue-gray primary - Scheme 3 */

    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 100%;

    --success: 142 76% 36%; /* #22c55e - Green for completed items */
    --success-foreground: 0 0% 100%;

    --warning: 45 93% 47%; /* #eab308 - Yellow/orange for in-progress */
    --warning-foreground: 0 0% 100%;

    --radius: 0.5rem;

    /* Hierarchy background colors for visual separation - Subtle Tint System */
    --sidebar-background: 200 12% 92%; /* Subtle blue-gray sidebar */
    --active-nav-background: 200 12% 85%; /* Active navigation item highlight - darker than hover (88%) */
    --tab-bar-background: 200 12% 85%; /* Tab bar background */
    --inactive-tab-background: 200 12% 80%; /* Inactive tab background */
    --active-tab-background: 0 0% 99%; /* Active tab matches content */
    --content-background: 0 0% 99%; /* Background color for main content */

    /* Icon Positioning System - Single source of truth */
    /* Used by node indicators and chevrons for consistent vertical alignment */
    /* Formula: containerPaddingPx + (fontSize × 0.75) */
    /* The 0.75 coefficient is empirically calibrated for optical text center */
    --icon-vertical-position: calc(0.25rem + (var(--font-size, 1rem) * 0.75));
  }

  .dark {
    /* Color system - Scheme 3: Subtle Tint System (dark mode) */
    --primary: 200 40% 55%; /* Blue-gray primary for Scheme 3 dark */
    --primary-foreground: 0 0% 95%; /* Very light gray for primary text */

    --secondary: 200 12% 14%; /* Dark blue-gray secondary for Scheme 3 */
    --secondary-foreground: 200 12% 60%; /* Light blue-gray for secondary text */

    --accent: 200 40% 55%; /* Blue-gray accent for Scheme 3 consistency */
    --accent-foreground: 0 0% 95%; /* Very light gray for accent text */

    --background: 0 0% 12%; /* More comfortable dark background (VS Code standard) */
    --foreground: 0 0% 90%; /* Light neutral gray text - Scheme 3 active items dark */

    --card: 200 12% 14%; /* Slightly elevated dark cards - Scheme 3 blue-gray */
    --card-foreground: 0 0% 90%; /* Light neutral gray text */

    --popover: 200 12% 14%; /* Same as cards - Scheme 3 blue-gray */
    --popover-foreground: 0 0% 90%;

    --muted: 200 12% 16%; /* Dark blue-gray muted areas - Scheme 3 */
    --muted-foreground: 0 0% 75%; /* Light neutral gray for muted text - Scheme 3 inactive items dark */

    /* Systematic hover states - WCAG-compliant contrast */
    --hover-background: var(--muted);
    --hover-foreground: var(--muted-foreground);

    --border: 200 12% 24%; /* Dark blue-gray borders - Scheme 3 */
    --input: 200 12% 26%; /* Slightly lighter for inputs - Scheme 3 */
    --ring: 200 40% 65%; /* Focus ring matches blue-gray primary - Scheme 3 */

    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 100%;

    --success: 142 76% 36%; /* #22c55e - Same green */
    --success-foreground: 0 0% 100%;

    --warning: 45 93% 47%; /* #eab308 - Same yellow/orange */
    --warning-foreground: 0 0% 100%;

    /* Dark mode hierarchy colors for visual separation - Subtle Tint System */
    --sidebar-background: 200 12% 14%; /* Subtle blue-gray sidebar dark */
    --active-nav-background: 200 12% 17%; /* Active navigation item highlight dark */
    --tab-bar-background: 200 12% 18%; /* Tab bar background dark */
    --inactive-tab-background: 200 12% 22%; /* Inactive tab background dark */
    --active-tab-background: 0 0% 12%; /* Active tab matches content dark */
    --content-background: 0 0% 12%; /* Background color for main content dark */

    /* Dark mode node colors are now defined at the end of the file for proper specificity */
  }
}

@layer base {
  * {
    border-color: hsl(var(--border));
  }

  /* Disable all transitions globally except for specific components */
  *,
  *::before,
  *::after {
    transition: none !important;
    animation-duration: 0s !important;
    animation-delay: 0s !important;
  }

  /* Sidebar slide animation */
  .navigation-sidebar.sidebar,
  .navigation-sidebar.sidebar.sidebar-collapsed,
  .navigation-sidebar.sidebar.sidebar-expanded {
    transition: width 0.25s ease-out !important;
    animation-duration: 0.25s !important;
  }

  html,
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden; /* Prevent scrollbars */
  }

  body {
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    /* NodeSpace font stack - Inter for UI, monospace for editing */
    font-family:
      Inter,
      -apple-system,
      BlinkMacSystemFont,
      'Segoe UI',
      Roboto,
      sans-serif;
  }
}

/* NodeSpace Design System Components - from patterns.html */

/* Blinking cursor animation for demo */
@keyframes blink {
  0%,
  50% {
    opacity: 1;
  }
  51%,
  100% {
    opacity: 0;
  }
}

/* Perfect Node Alignment System - CSS Variables Architecture */
.node-viewer {
  /* Dynamic Circle Positioning System - All values configurable from here */
  --circle-offset: 22px; /* Circle center distance from container left edge - reserves space for chevrons */
  --circle-diameter: 20px; /* Circle size (width and height) */
  --circle-text-gap: 8px; /* Gap between circle edge and text content */
  --node-indent: 2.5rem; /* Indentation distance between parent and child levels */

  /* Base correction factor for text visual center alignment */
  --baseline-correction: -0.06375em;
}

/* Hierarchy Node with Perfect Alignment System */
.hierarchy-node {
  position: relative;
  cursor: pointer;
  border-radius: 0.25rem;
  transition: background-color 0.15s ease;
  /* Dynamic padding calculation: circle-offset + circle-diameter + circle-text-gap */
  padding-left: calc(
    var(--circle-offset, 22px) + var(--circle-diameter, 20px) + var(--circle-text-gap, 8px)
  );
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
  min-height: calc(var(--circle-diameter, 20px) + 0.5rem); /* Ensure minimum height for circle */

  /* Default values for normal text (1rem × 1.6 = 1.6rem line-height) */
  --line-height: 1.6;
  --font-size: 1rem;
  --line-height-px: calc(var(--font-size) * var(--line-height));
}

/* Child Node Indentation System - Match Svelte implementation exactly */
.hierarchy-node.child-1 {
  margin-left: 2.5rem; /* Single indentation level: 40px */
}

.hierarchy-node.child-2 {
  margin-left: 5rem; /* Double indentation level: 80px */
}

/* Circle Indicators - Use same system as BaseNode/TextNode sections */
.hierarchy-indicator {
  position: absolute;
  left: var(--circle-offset, 22px);
  top: calc(0.25rem + (var(--line-height-px) / 2));
  transform: translateY(-50%);
  width: var(--circle-diameter, 20px);
  height: var(--circle-diameter, 20px);
  flex-shrink: 0;
  z-index: 2;
}

/* Icon System CSS - All node types */
.task-icon {
  width: var(--circle-diameter, 20px);
  height: var(--circle-diameter, 20px);
  position: relative;
  display: block;
}

.node-icon {
  width: var(--circle-diameter, 20px);
  height: var(--circle-diameter, 20px);
  position: relative;
  display: block;
}

.ai-icon {
  width: var(--circle-diameter, 20px);
  height: var(--circle-diameter, 20px);
  position: relative;
  display: block;
}

/* Header Square Icons - H1, H2, H3 with punch-hole text effect */
.h1-square-alt,
.h2-square-alt,
.h3-square-alt {
  width: 16px;
  height: 16px;
  position: absolute;
  top: 2px;
  left: 2px;
  border-radius: 0.5px;
  overflow: hidden;
}

.h1-square-alt::before,
.h2-square-alt::before,
.h3-square-alt::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: hsl(var(--primary));
}

.h1-square-alt::after,
.h2-square-alt::after,
.h3-square-alt::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 14px;
  height: 14px;
  transform: translate(-50%, -50%);
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
}

.h1-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Ctext x='10' y='12.5' fill='%23FAF9F5' text-anchor='middle' dominant-baseline='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif' font-size='16' font-weight='400'%3EH1%3C/text%3E%3C/svg%3E");
}

.h2-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Ctext x='10' y='12.5' fill='%23FAF9F5' text-anchor='middle' dominant-baseline='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif' font-size='16' font-weight='400'%3EH2%3C/text%3E%3C/svg%3E");
}

.h3-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Ctext x='10' y='12.5' fill='%23FAF9F5' text-anchor='middle' dominant-baseline='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif' font-size='16' font-weight='400'%3EH3%3C/text%3E%3C/svg%3E");
}

.dark .h1-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Ctext x='10' y='12.5' fill='%23252523' text-anchor='middle' dominant-baseline='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif' font-size='16' font-weight='400'%3EH1%3C/text%3E%3C/svg%3E");
}

.dark .h2-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Ctext x='10' y='12.5' fill='%23252523' text-anchor='middle' dominant-baseline='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif' font-size='16' font-weight='400'%3EH2%3C/text%3E%3C/svg%3E");
}

.dark .h3-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Ctext x='10' y='12.5' fill='%23252523' text-anchor='middle' dominant-baseline='middle' font-family='-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif' font-size='16' font-weight='400'%3EH3%3C/text%3E%3C/svg%3E");
}

/* Text Node Circle */
.text-circle {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: hsl(var(--node-text));
  position: absolute;
  top: 3px;
  left: 3px;
}

/* Task Circle States */
.task-circle {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  position: absolute;
  top: 2px;
  left: 2px;
}

.task-circle-pending {
  background: transparent;
  border: 1px solid hsl(var(--primary));
  box-sizing: border-box;
}

.task-circle-in-progress {
  background: linear-gradient(90deg, hsl(var(--primary)) 50%, transparent 50%);
  border: 1px solid hsl(var(--primary));
  box-sizing: border-box;
}

.task-circle-completed {
  background: hsl(var(--primary));
}

/* Checkmark for completed tasks - theme-aware stroke color */
.task-circle-completed::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  width: 10px;
  height: 8px;
  transform: translate(-50%, -50%);
  background-image: url("data:image/svg+xml,%3Csvg width='10' height='8' viewBox='0 0 10 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 4L3.5 6.5L9 1' stroke='%23FAF9F5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
}

.dark .task-circle-completed::after {
  background-image: url("data:image/svg+xml,%3Csvg width='10' height='8' viewBox='0 0 10 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 4L3.5 6.5L9 1' stroke='%23252523' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
}

/* Task Ring for Parent Nodes */
.task-ring {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 8px solid hsl(var(--node-text) / 0.5);
  box-sizing: border-box;
  position: absolute;
  top: 0;
  left: 0;
}

/* AI Chat Node Square Icons */
.ai-square-alt {
  width: 16px;
  height: 16px;
  position: absolute;
  top: 2px;
  left: 2px;
  border-radius: 0.5px;
}

.ai-square-alt::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: hsl(var(--primary));
  border-radius: inherit;
}

.ai-square-alt::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 14px;
  height: 14px;
  transform: translate(-50%, -50%);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'%3E%3Cpath d='M80-120v-80h800v80H80Zm680-160v-560h60v560h-60Zm-600 0 210-560h100l210 560h-96l-50-144H308l-52 144h-96Zm176-224h168l-82-232h-4l-82 232Z' fill='%23FAF9F5'/%3E%3C/svg%3E");
  mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'%3E%3Cpath d='M80-120v-80h800v80H80Zm680-160v-560h60v560h-60Zm-600 0 210-560h100l210 560h-96l-50-144H308l-52 144h-96Zm176-224h168l-82-232h-4l-82 232Z' fill='%23FAF9F5'/%3E%3C/svg%3E")
    no-repeat center;
  mask-size: contain;
  -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'%3E%3Cpath d='M80-120v-80h800v80H80Zm680-160v-560h60v560h-60Zm-600 0 210-560h100l210 560h-96l-50-144H308l-52 144h-96Zm176-224h168l-82-232h-4l-82 232Z' fill='%23FAF9F5'/%3E%3C/svg%3E")
    no-repeat center;
  -webkit-mask-size: contain;
}

.dark .ai-square-alt::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'%3E%3Cpath d='M80-120v-80h800v80H80Zm680-160v-560h60v560h-60Zm-600 0 210-560h100l210 560h-96l-50-144H308l-52 144h-96Zm176-224h168l-82-232h-4l-82 232Z' fill='%23252523'/%3E%3C/svg%3E");
}

.ai-square-ring {
  width: 20px;
  height: 20px;
  border-radius: 1px;
  border: 2px solid hsl(var(--primary) / 0.5);
  box-sizing: border-box;
  position: absolute;
  top: 0;
  left: 0;
}

/* Dropdown System - @mention and slash commands */
.dropdown-menu {
  position: absolute;
  min-width: 300px;
  background: hsl(var(--popover));
  border: 1px solid hsl(var(--border));
  border-radius: var(--radius);
  z-index: 10;
  box-shadow:
    0 4px 6px -1px rgb(0 0 0 / 0.1),
    0 2px 4px -2px rgb(0 0 0 / 0.1);
}

.dropdown-item {
  padding: 0.75rem;
  border-bottom: 1px solid hsl(var(--border));
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background-color 0.15s ease;
}

.dropdown-item:hover {
  background: hsl(var(--muted));
}

.dropdown-item:last-child {
  border-bottom: none;
}

.dropdown-item-icon {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.dropdown-item-content {
  font-weight: 500;
}

.dropdown-create-action {
  color: hsl(var(--foreground));
  background: hsl(var(--muted) / 0.5);
  font-weight: 600;
  text-align: center;
}

.dropdown-create-action:hover {
  background: hsl(var(--muted));
  color: hsl(var(--foreground));
}

.search-highlight {
  color: hsl(var(--primary));
  font-weight: 600;
}

/* NodeSpace Extensions - Design system aligned colors */
:root {
  /* NodeSpace node-specific extensions - Subtle Tint System (Light mode) */
  --node-text: 200 40% 45%; /* Text nodes use Scheme 3 blue-gray light */
  --node-task: 200 40% 45%; /* Task nodes use Scheme 3 blue-gray light */
  --node-ai-chat: 200 40% 45%; /* AI chat nodes use Scheme 3 blue-gray light */
  --node-entity: 200 40% 45%; /* Entity nodes use Scheme 3 blue-gray light */
  --node-query: 200 40% 45%; /* Query nodes use Scheme 3 blue-gray light */
  --node-user: 200 40% 45%; /* User nodes use Scheme 3 blue-gray light */
  --node-date: 200 40% 45%; /* Date nodes use Scheme 3 blue-gray light */
  --node-document: 200 40% 45%; /* Document nodes use Scheme 3 blue-gray light */
  --processing-opacity: 0.7;
}

/* Dark mode overrides for NodeSpace node colors */
.dark {
  /* Override node colors for dark theme - these must be after the light mode definitions */
  --node-text: 200 40% 55%; /* Text nodes use Scheme 3 blue-gray dark */
  --node-task: 200 40% 55%; /* Task nodes use Scheme 3 blue-gray dark */
  --node-ai-chat: 200 40% 55%; /* AI chat nodes use Scheme 3 blue-gray dark */
  --node-entity: 200 40% 55%; /* Entity nodes use Scheme 3 blue-gray dark */
  --node-query: 200 40% 55%; /* Query nodes use Scheme 3 blue-gray dark */
  --node-user: 200 40% 55%; /* User nodes use Scheme 3 blue-gray dark */
  --node-date: 200 40% 55%; /* Date nodes use Scheme 3 blue-gray dark */
  --node-document: 200 40% 55%; /* Document nodes use Scheme 3 blue-gray dark */
}
